<html>
	<head>
		<title>Virtual VPU</title>
	</head>
	<body>
		<h2>VirtualFPU<h2>
			<h4>

This is a plain standard C++20 self contained mathematical expression compiler and evaluator.
Internally uses a RPN (Reverse Polish Notation) stack to evalute the expression.
No additional libraries are required.
</h4>

<h3>Usage example:</h3>

<!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">    <span style="color: #d0d0d0">RPNCompiler</span> <span style="color: #d0d0d0">fpu;</span>        
        
  <span style="color: #d0d0d0">fpu.compile(</span><span style="color: #ed9d13">&quot;4*sin(-1.2)+(-1*(8/9+5/6))&quot;</span><span style="color: #d0d0d0">);</span>
       
  <span style="color: #d0d0d0">std::cout&lt;&lt;fpu.evaluate()&lt;&lt;std::endl;</span>   <span style="color: #999999; font-style: italic">//prints -5.45038</span>
</pre></div>


<h3>Features</h3>

All values are treated as C++ double (no template supported yet!)

- available operators:
  \+ addition, - subtraction, * multiplication, / division, - unary minus, ^ power
- available built-in functions
  sin,cos,tan,asin,acos,atan,sinh,cosh,acosh,atanh,exp (base-e exponential function),log (natural logarithm), log10 (base 10 loh),log2 (base 2 log),sign (signum)  
  
- custom defined variables
  Define one or more variables and use in the expression:
  
<!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">  <span style="color: #d0d0d0">RPNCompiler</span> <span style="color: #d0d0d0">fpu;</span>      

    <span style="color: #d0d0d0">fpu.defineVar(</span><span style="color: #ed9d13">&quot;x&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1.67</span><span style="color: #d0d0d0">);</span>
    <span style="color: #d0d0d0">fpu.defineVar(</span><span style="color: #ed9d13">&quot;PI&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">M_PI);</span> 
    
    <span style="color: #d0d0d0">fpu.compile(</span><span style="color: #ed9d13">&quot;tan(PI/4)+x^2&quot;</span><span style="color: #d0d0d0">);</span>
    
    <span style="color: #d0d0d0">std::cout&lt;&lt;fpu.evaluate()&lt;&lt;std::endl;</span>   <span style="color: #999999; font-style: italic">//prints 3.7889</span>
    
    <span style="color: #999999; font-style: italic">//change the value of x and evaluate without compiling again  </span>
    <span style="color: #d0d0d0">fpu.defineVar(</span><span style="color: #ed9d13">&quot;x&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">);</span>
    
    <span style="color: #d0d0d0">std::cout&lt;&lt;fpu.evaluate()&lt;&lt;std::endl;</span>   <span style="color: #999999; font-style: italic">//now prints 5      </span>
</pre></div>


- custom defined functions
 Define any number of custom functions with a single double argument and returning a double:

<!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">    <span style="color: #d0d0d0">RPNCompiler</span> <span style="color: #d0d0d0">fpu;</span> 

     <span style="color: #d0d0d0">fpu.defineFunction(</span><span style="color: #ed9d13">&quot;cube&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[](</span><span style="color: #6ab825; font-weight: bold">double</span> <span style="color: #d0d0d0">v)</span> <span style="color: #d0d0d0">{</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">v*v*v;</span>
     <span style="color: #d0d0d0">});</span>
        
     <span style="color: #d0d0d0">fpu.defineFunction(</span><span style="color: #ed9d13">&quot;inv&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[](</span><span style="color: #6ab825; font-weight: bold">double</span> <span style="color: #d0d0d0">v)</span> <span style="color: #d0d0d0">{</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">/v;</span>
     <span style="color: #d0d0d0">});</span>

     <span style="color: #999999; font-style: italic">//compile a statement using the custom functions</span>
     <span style="color: #d0d0d0">fpu.compile(</span><span style="color: #ed9d13">&quot;cube(3)/4+5/cube(2)-1/(1-inv(cube(2)))&quot;</span><span style="color: #d0d0d0">)</span>

     <span style="color: #d0d0d0">std::cout&lt;&lt;fpu.evaluate()&lt;&lt;std::endl;</span>
</pre></div>



<h3>Include in your program</h3>

Warning! A C++20 compliant compiler is required
This software has been tested using gcc11

- Add virtualfpu.cpp in your source dir
- Add virtualfpu.h in your headers files



<h href="https://github.com/leon972/VirtualFPU" target="_blank">GitHub repository for this project</h>


  
  

	</body>
</html>